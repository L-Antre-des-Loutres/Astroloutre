---
// Enregistrement du type de tableau Discord ID
import {slugify} from "../../formater/JoueurFormater";

type discordID = {
    DiscordId: string;
};

type DiscordUserType = {
    id: number;
    discord_id: string;
    tag_discord: string;
    pseudo_discord: string;
    avatar_url: string;
};

const discordFondateur: discordID[] = [
    { DiscordId: "518780404057112580" },
    {DiscordId: "383676607434457088"},
];

const discordInvestisseur: discordID[] = [
    {DiscordId: "556501819468152832"},
    {DiscordId: "432541622065168385"},
    {DiscordId: "442285755113668609"},
    {DiscordId: "334269770809606154"},
];

const apiUrl = 'https://otterlyapi.antredesloutres.fr/api/utilisateurs_discord/';
const response = await fetch(apiUrl);
if (!response.ok) {
    throw new Error(`Erreur API joueurs: ${response.status}`);
}
const json = await response.json();
if (!json.success || !Array.isArray(json.data)) {
    throw new Error('Données API invalides');
}
const utilisateurs: DiscordUserType[] = json.data;

// Filtrer fondateurs
const idsFondateurs = discordFondateur.map(f => f.DiscordId);
const fondateurs = utilisateurs.filter(u => idsFondateurs.includes(u.discord_id));

// Filtrer investisseurs
const idsInvestisseurs = discordInvestisseur.map(i => i.DiscordId);
const investisseurs = utilisateurs.filter(u => idsInvestisseurs.includes(u.discord_id));

// Vérifie si un utilisateur apparait plusieurs fois si c'est le cas on ne prend que le premier pour les fondateurs et les investisseurs
const uniqueFondateurs = [...new Set(fondateurs.map(u => u.discord_id))].map(id => fondateurs.find(u => u.discord_id === id)!);
const uniqueInvestisseurs = [...new Set(investisseurs.map(u => u.discord_id))].map(id => investisseurs.find(u => u.discord_id === id)!);
---

<style>
    /* Sections */
    .fondateurs-section, .investisseurs-section, .partenaires-section {
        margin-bottom: 2.5rem;
        text-align: center;
    }

    .fondateurs-section h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #b45309; /* amber-800 */
        margin-bottom: 1rem;
    }

    .investisseurs-section h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #047857; /* emerald-600 */
        margin-bottom: 1rem;
    }

    .partenaires-section h3 {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937; /* gray-800 */
        margin-bottom: 1rem;
    }

    /* Liste */
    .user-list {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1.5rem; /* espace entre les cases */
        padding: 0;
        margin: 0;
        list-style: none;
    }

    /* Carte utilisateur */
    .user-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.2s;
    }

    .user-card:hover {
        transform: scale(1.05);
    }

    /* Lien */
    .user-link {
        width: 100%;
        text-decoration: none;
    }

    /* Contenu interne */
    .user-content {
        border-radius: 0.75rem;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: all 0.2s;
        min-height: 12.5rem;
    }

    /* Avatar */
    .user-avatar {
        width: 5rem;
        height: 5rem;
        border-radius: 50%;
        margin-bottom: 0.75rem;
    }

    .fondateur-border {
        border: 2px solid #b45309;
        transition: all 0.2s;
    }

    .fondateur-border:hover {
        transform: scale(1.05);
    }

    .investisseur-border {
        border: 2px solid #047857;
        transition: all 0.2s;
    }

    .investisseur-border:hover {
        transform: scale(1.05);
    }

    .partenaire-border {
        border: 2px solid #1f2937;
        transition: all 0.2s;
    }

    .partenaire-border:hover {
        transform: scale(1.05);
    }

    .user-card.investisseur .user-avatar {
        border-color: #29e694;
    }

    .user-card:hover .user-avatar {
        filter: brightness(1.05);
    }

    /* Pseudo et tag */
    .user-name {
        font-weight: 500;
        color: #1f2937;
        font-size: 0.875rem;
        word-break: break-word;
    }

    .user-tag {
        font-size: 0.75rem;
        color: #6b7280;
        word-break: break-word;
    }

    /* Responsive : 2 éléments par ligne sur petit écran */
    @media (max-width: 640px) {
        .user-card {
            width: 50%;
        }
    }

    /* Responsive : 3 éléments par ligne sur écran moyen */
    @media (min-width: 641px) and (max-width: 1024px) {
        .user-card {
            width: 33.33%;
        }
    }

    /* Responsive : 4 éléments par ligne sur grand écran */
    @media (min-width: 1025px) {
        .user-card {
            width: 10rem;
        }
    }

</style>

<!-- Organigramme -->
<div class="organigramme w-full bg-white px-6 py-2">

    <!-- Section Fondateurs -->
    <section class="fondateurs-section">
        <h3>Fondateurs</h3>
        <ul class="user-list">
            {uniqueFondateurs.map((user) => (
                    <li key={user.tag_discord} className="user-card fondateur">
                        <a href={`/profil/${slugify(user.tag_discord)}`} class="user-link">
                            <div class="user-content">
                                <img
                                        src={user.avatar_url}
                                        alt={`Avatar de ${user.pseudo_discord}`}
                                        class="user-avatar fondateur-border"
                                />
                                <div class="user-name">{user.pseudo_discord}</div>
                                <div class="user-tag">{user.tag_discord}</div>
                            </div>
                        </a>
                    </li>
            ))}
        </ul>
    </section>

    <!-- Section Investisseurs -->
    <section class="investisseurs-section">
        <h3>Nos investisseurs</h3>
        <ul class="user-list">
            {uniqueInvestisseurs.map((user) => (
                    <li key={user.tag_discord} className="user-card investisseur">
                        <a href={`/profil/${slugify(user.tag_discord)}`} class="user-link">
                            <div class="user-content">
                                <img
                                        src={user.avatar_url}
                                        alt={`Avatar de ${user.pseudo_discord}`}
                                        class="user-avatar investisseur-border"
                                />
                                <div class="user-name">{user.pseudo_discord}</div>
                                <div class="user-tag">{user.tag_discord}</div>
                            </div>
                        </a>
                    </li>
            ))}
        </ul>
    </section>

    <!-- Section partenaires -->
    <section class="partenaires-section">
        <h3>Nos partenaires</h3>
        <ul class="user-list">
            <li class="user-card">
                <a href="https://discord.gg/eJxb9fXUgZ" class="user-link">
                    <div class="user-content">
                        <img
                                src="/logo/cripie_club_logo.webp"
                                alt="Logo cripie club"
                                class="user-avatar partenaire-border"
                        >
                        <div class="user-name">Cripie Club</div>
                        <div class="user-tag">cripie333</div>
                    </div>

                </a>
            </li>
        </ul>
    </section>
</div>

