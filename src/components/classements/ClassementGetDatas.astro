---
// Composant : ClassementGetDatas.astro
import PlayerClassementReactComposant from './PlayerClassement.tsx';

const { jeu } = Astro.props;

// Déclaration des types
type Server = {
    id: number;
    nom: string;
};

type PlayerStats = {
    playername: string;
    uuid: string;
    tmps_jeu: number;
    nb_mort: number;
    nb_kills: number;
    nb_playerkill: number;
    nb_blocs_detr: number;
    nb_blocs_pose: number;
    dist_total: number;
}

// Récupération de la liste des serveurs
const res = await fetch("https://otterlyapi.antredesloutres.fr/api/serveurs/actif-global/" + jeu);
const json = await res.json();

const serversList: Record<string, string> = {};
(json.data as Server[]).forEach((server) => {
    serversList[server.id.toString()] = server.nom;
});

// Récupération des statistique de joueurs
const allData: Record<string, any[]> = {
    "1": [
        { playername: "Alice", uuid: "uuid-alice", tmps_jeu: 120, nb_mort: 5, nb_kills: 30, nb_playerkill: 3, nb_blocs_detr: 1000, nb_blocs_pose: 800, dist_total: 30000, dist_pieds: 20000, dist_elytres: 10000 },
    ],
    "2": [
        { playername: "Bob", uuid: "uuid-bob", tmps_jeu: 90, nb_mort: 2, nb_kills: 15, nb_playerkill: 1, nb_blocs_detr: 500, nb_blocs_pose: 1200, dist_total: 15000, dist_pieds: 10000, dist_elytres: 5000 },
    ],
    "5": [
        { playername: "Charlie", uuid: "uuid-charlie", tmps_jeu: 200, nb_mort: 10, nb_kills: 40, nb_playerkill: 8, nb_blocs_detr: 2000, nb_blocs_pose: 1500, dist_total: 50000, dist_pieds: 30000, dist_elytres: 20000 },
    ],
};
---

<PlayerClassementReactComposant client:load {serversList} {allData} />
